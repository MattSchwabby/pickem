<% include ../partials/header %>

<div class="row text-left"></div>
    <div class="col-sm-4 col-sm-offset-4 text-left">
        <p class="lead">User Name: <%=user.name%></p>
        <%
        if(user.image)
        { %>
        <div class="profilePictureContainer">
            <img class="profilePicture" src="<%=user.image%>">
        </div>
        <% } %>
        
         <%
         var totalFollowers = 0, totalFollowing = 0;
        if(user.followers.count>1)
        { 
            totalFollowers = user.followers.count
        }

        if(user.following.count>1)
        { 
            
            totalFollowing = user.following.count
            
        } %>
        
        <p>Total followers: <%=totalFollowers%> | Total following: <%=totalFollowing%></p>
        <%
        if(user.stats.totalPicks)
        { %>

            <p>Total picks: <%=user.stats.totalPicks%></p>
            <p>Lifetime correct picks: <%=user.stats.correctPicks%></p>
            <p>Lifetime correct picks against the spread: <%=user.stats.correctSpreadPicks%></p>
            <p>Participated in <%=user.stats.totalPools%> pools</p>

        <%
        } 
        else
        { %>
            <p><%=user.username%> has not made any picks.</p>
        <%
        } %>
        
        <br>
       
    </div>
</div>
<div class="row">
    <%
    currentUser.following.forEach(function(follow)
    {
        console.log ("FOLLOWER IDS ARE ");
        console.log(follow)
        var areFriends = false;
        if(follow.id === user.id)
        { %>
            <form action="/users/<%=user.id%>/unfollow" method="POST">
                <div class="col-xs-12 text-center">
                        <button type="submit" id="pool-button" class="btn btn-primary"><i class="icon-user-plus"></i> Unfollow <%=user.name%></button>
                </div>
                </form>
            <%
            areFriends = true;
        }
        else if(!areFriends)
        { %>
            <form action="/users/<%=user.id%>/follow" method="POST">
                <div class="col-xs-12 text-center">
                        <button type="submit" id="pool-button" class="btn btn-primary"><i class="icon-user-plus"></i> Follow <%=user.name%></button>
                </div>
            </form>
            <%
        }
    }) %> <!-- end for each current users' following -->
    <%
    if(currentUser.following = [] && currentUser.following.count < 1)
        { %>
        <form action="/users/<%=user.id%>/follow" method="POST">
            <div class="col-xs-12 text-center">
                    <button type="submit" id="pool-button" class="btn btn-primary"><i class="icon-user-plus"></i> Follow <%=user.name%></button>
            </div>
            </form>
            <%
        }
        %>
    <% if(user.id === currentUser.id)
    { %>
        <div class="col-xs-12 text-center">
            <a class="btn btn-primary" id="pool-button" href="/users/<%=currentUser.id%>/edit">Edit profile</a>
        </div>
<%  } %>
</div><!-- end row -->

<% include ../partials/footer %>